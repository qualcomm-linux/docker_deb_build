# Use an official Ubuntu base image
FROM ubuntu:noble

# Prevent interactive prompts during package installation
ENV DEBIAN_FRONTEND=noninteractive

COPY base-packages.txt /tmp/base-packages.txt

# Update package list and install dependencies
RUN apt-get update && \
    apt-get install -y $(cat /tmp/base-packages.txt | tr '\n' ' ') && \
    apt-get clean && \
    rm -rf /var/lib/apt/lists/*
    
# Build the noble chroot
RUN sbuild-createchroot --arch=amd64 --components=main,universe noble    /srv/chroot/noble    http://archive.ubuntu.com/ubuntu && \
    chroot /srv/chroot/noble /bin/bash -c "\
        echo 'deb [arch=amd64] http://archive.ubuntu.com/ubuntu     noble          main restricted universe multiverse' >  /etc/apt/sources.list && \
        echo 'deb [arch=amd64] http://archive.ubuntu.com/ubuntu     noble-updates  main restricted universe multiverse' >> /etc/apt/sources.list && \
        echo 'deb [arch=amd64] http://archive.ubuntu.com/ubuntu     noble-security main restricted universe multiverse' >> /etc/apt/sources.list && \
        echo 'deb [arch=arm64] http://ports.ubuntu.com/ubuntu-ports noble          main restricted universe multiverse' >  /etc/apt/sources.list.d/arm64-ports.list && \
        echo 'deb [arch=arm64] http://ports.ubuntu.com/ubuntu-ports noble-updates  main restricted universe multiverse' >> /etc/apt/sources.list.d/arm64-ports.list && \
        echo 'deb [arch=arm64] http://ports.ubuntu.com/ubuntu-ports noble-security main restricted universe multiverse' >> /etc/apt/sources.list.d/arm64-ports.list && \
        dpkg --add-architecture arm64 && \
        apt-get update && \
        apt-get upgrade -y && \
        apt-get install -y crossbuild-essential-arm64"

# Set working directory
WORKDIR /workspace

# Default command
CMD [ "bash" ]